<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Asset Hub â€” simplywasreal-jpg</title>
  <meta name="description" content="Download game-ready 3D models and assets from simplywasreal-jpg" />
  <link rel="stylesheet" href="assets/styles.css">
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a class="brand" href="/">
        <svg class="logo" viewBox="0 0 48 48" width="36" height="36" aria-hidden><rect x="6" y="6" width="36" height="36" rx="6" fill="#0366d6"/><path d="M14 30 L20 18 L28 34 L34 18" stroke="#fff" stroke-width="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
        <span>Asset Hub</span>
      </a>

      <nav class="header-actions">
        <a class="btn btn-muted" href="README.md" target="_blank" rel="noopener">Uploader & Docs</a>
        <a class="btn btn-primary" href="#upload-info">How to upload</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <h1>Game-ready 3D models & assets</h1>
      <p class="lead">Browse, search and download models shared by simplywasreal-jpg. Common formats: <strong>.fbx .obj .gltf .blend .zip</strong>.</p>

      <div class="controls">
        <div class="search">
          <input id="searchInput" type="search" placeholder="Search by filename, format, or tag (example: character, prop)"/>
        </div>

        <div class="filters">
          <label>Filter:</label>
          <div id="filterButtons" class="filter-buttons" aria-hidden>
            <button data-ext="" class="filter active">All</button>
            <button data-ext=".fbx" class="filter">FBX</button>
            <button data-ext=".obj" class="filter">OBJ</button>
            <button data-ext=".gltf" class="filter">glTF</button>
            <button data-ext=".blend" class="filter">BLEND</button>
            <button data-ext=".zip" class="filter">ZIP</button>
            <button data-ext=".png,.jpg,.jpeg,.gif" class="filter">Images</button>
          </div>
        </div>

        <div class="sort">
          <label for="sortSelect">Sort:</label>
          <select id="sortSelect">
            <option value="name">Name (Aâ€“Z)</option>
            <option value="size">Size (smallest)</option>
          </select>
        </div>
      </div>
    </section>

    <section>
      <div id="resultsInfo" class="results-info" aria-live="polite"></div>
      <div id="grid" class="grid" role="list"></div>
      <div id="empty" class="empty" style="display:none;">No files found. Upload assets to the <code>/files</code> folder or use the uploader.</div>
    </section>

    <section id="upload-info" class="upload-info">
      <h2>How to upload (admin only)</h2>
      <p>Only you (the repository owner) should upload. Use the separate uploader service described in <a href="README.md" target="_blank" rel="noopener">the README</a>, or add files directly via git to <code>/files</code>.</p>
      <ol>
        <li>Create a GitHub Personal Access Token with repo write access.</li>
        <li>Run the uploader server (see README) or push files with git to <code>/files</code>.</li>
      </ol>
      <p class="muted">Tip: name files with descriptive names and include format and polycount in the filename (eg. <code>medieval-rock_1ktris_fbx.zip</code>).</p>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container footer-inner">
      <div>Repository: <a href="https://github.com/simplywasreal-jpg/simplywasreal-jpg.github.io" target="_blank" rel="noopener">simplywasreal-jpg/simplywasreal-jpg.github.io</a></div>
      <div class="muted">Hosted on GitHub Pages Â· Admin uploader required to add files</div>
    </div>
  </footer>

  <!-- Preview modal -->
  <div id="previewModal" class="modal" aria-hidden>
    <div class="modal-panel">
      <button id="modalClose" class="modal-close" aria-label="Close preview">&times;</button>
      <div id="modalContent" class="modal-content"></div>
      <div id="modalMeta" class="modal-meta"></div>
    </div>
  </div>

<script>
  // Configuration
  const owner = "simplywasreal-jpg";
  const repo = "simplywasreal-jpg.github.io";
  const path = "files";
  const ref = "main";

  // Elements
  const grid = document.getElementById('grid');
  const empty = document.getElementById('empty');
  const searchInput = document.getElementById('searchInput');
  const filterButtons = document.getElementById('filterButtons');
  const sortSelect = document.getElementById('sortSelect');
  const resultsInfo = document.getElementById('resultsInfo');
  const previewModal = document.getElementById('previewModal');
  const modalContent = document.getElementById('modalContent');
  const modalMeta = document.getElementById('modalMeta');
  const modalClose = document.getElementById('modalClose');

  let items = [];
  let activeFilter = '';
  let searchTerm = '';

  function extOf(name) {
    const m = name.match(/(\.[^.]+)$/);
    return m ? m[1].toLowerCase() : '';
  }

  function friendlySize(bytes) {
    if (bytes == null) return '';
    if (bytes < 1024) return bytes + ' B';
    if (bytes < 1024*1024) return (bytes/1024).toFixed(1) + ' KB';
    return (bytes/1024/1024).toFixed(2) + ' MB';
  }

  function iconFor(ext) {
    if (!ext) return 'ðŸ“';
    const map = {
      '.fbx':'ðŸ§©', '.obj':'ðŸ”·', '.gltf':'ðŸ”¶', '.glb':'ðŸ”¶', '.blend':'ðŸŽ›ï¸',
      '.zip':'ðŸ“¦', '.rar':'ðŸ“¦', '.7z':'ðŸ“¦', '.png':'ðŸ–¼ï¸', '.jpg':'ðŸ–¼ï¸', '.jpeg':'ðŸ–¼ï¸', '.gif':'ðŸ–¼ï¸'
    };
    return map[ext] || 'ðŸ“„';
  }

  async function fetchFiles() {
    const url = `https://api.github.com/repos/${owner}/${repo}/contents/${path}?ref=${ref}`;
    try {
      const res = await fetch(url);
      if (res.status === 404) {
        items = [];
        render();
        return;
      }
      if (!res.ok) throw new Error('GitHub API returned ' + res.status);
      const json = await res.json();
      if (!Array.isArray(json)) {
        items = [];
        render();
        return;
      }
      // Map to internal items
      items = json.map(it => ({
        name: it.name,
        path: it.path,
        download_url: it.download_url || it.html_url,
        size: it.size || 0,
        type: it.type,
        ext: extOf(it.name)
      }));
      render();
    } catch (err) {
      console.error(err);
      resultsInfo.textContent = 'Error loading files: ' + err.message;
    }
  }

  function render() {
    grid.innerHTML = '';
    let visible = items.slice();

    // Search
    if (searchTerm.trim()) {
      const s = searchTerm.toLowerCase();
      visible = visible.filter(i => (i.name || '').toLowerCase().includes(s));
    }

    // Filter
    if (activeFilter) {
      const exts = activeFilter.split(',').map(e => e.trim().toLowerCase()).filter(Boolean);
      visible = visible.filter(i => exts.includes(i.ext));
    }

    // Sort
    const sort = sortSelect.value;
    if (sort === 'size') visible.sort((a,b)=> (a.size||0) - (b.size||0));
    else visible.sort((a,b)=> (a.name||'').localeCompare(b.name||''));

    // Info
    resultsInfo.textContent = `${visible.length} item${visible.length === 1 ? '' : 's'} found`;

    if (visible.length === 0) {
      empty.style.display = 'block';
      return;
    } else {
      empty.style.display = 'none';
    }

    for (const it of visible) {
      const card = document.createElement('article');
      card.className = 'card';
      card.setAttribute('role','listitem');

      const left = document.createElement('div');
      left.className = 'card-left';
      const icon = document.createElement('div');
      icon.className = 'card-icon';
      icon.textContent = iconFor(it.ext);
      left.appendChild(icon);

      const body = document.createElement('div');
      body.className = 'card-body';
      const title = document.createElement('div');
      title.className = 'card-title';
      title.textContent = it.name;
      body.appendChild(title);

      const meta = document.createElement('div');
      meta.className = 'card-meta';
      meta.innerHTML = `<span class="badge">${it.ext || 'file'}</span> <span class="muted">${friendlySize(it.size)}</span>`;
      body.appendChild(meta);

      const actions = document.createElement('div');
      actions.className = 'card-actions';
      const dl = document.createElement('a');
      dl.className = 'btn btn-primary';
      dl.href = it.download_url;
      dl.target = '_blank';
      dl.rel = 'noopener';
      dl.textContent = 'Download';
      actions.appendChild(dl);

      // If previewable image, add preview button
      if (['.png','.jpg','.jpeg','.gif'].includes(it.ext)) {
        const pv = document.createElement('button');
        pv.className = 'btn btn-outline';
        pv.textContent = 'Preview';
        pv.addEventListener('click', () => openPreview(it));
        actions.appendChild(pv);
      }

      card.appendChild(left);
      card.appendChild(body);
      card.appendChild(actions);
      grid.appendChild(card);
    }
  }

  function openPreview(item) {
    modalContent.innerHTML = '';
    modalMeta.textContent = `${item.name} â€¢ ${friendlySize(item.size)}`;
    // Only preview images in this simple UI
    if (['.png','.jpg','.jpeg','.gif'].includes(item.ext)) {
      const img = document.createElement('img');
      img.src = item.download_url;
      img.alt = item.name;
      img.className = 'preview-img';
      modalContent.appendChild(img);
    } else {
      modalContent.textContent = 'Preview not available for this file type. Use Download to obtain the asset.';
    }
    previewModal.style.display = 'flex';
    previewModal.setAttribute('aria-hidden','false');
  }

  function closePreview() {
    previewModal.style.display = 'none';
    previewModal.setAttribute('aria-hidden','true');
    modalContent.innerHTML = '';
  }

  // Event bindings
  searchInput.addEventListener('input', (e) => {
    searchTerm = e.target.value || '';
    render();
  });

  filterButtons.addEventListener('click', (e) => {
    const btn = e.target.closest('button[data-ext]');
    if (!btn) return;
    // toggle active
    [...filterButtons.querySelectorAll('button')].forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    activeFilter = btn.getAttribute('data-ext') || '';
    render();
  });

  sortSelect.addEventListener('change', render);

  modalClose.addEventListener('click', closePreview);
  previewModal.addEventListener('click', (e) => {
    if (e.target === previewModal) closePreview();
  });

  // Initial load
  fetchFiles();
</script>
</body>
</html>
